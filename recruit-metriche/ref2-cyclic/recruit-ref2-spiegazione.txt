Contestualizzazione del problema
Nel package com.stalary.pf.message.data.vo si trova la classe ResponseMessage<T>, utilizzata per modellare le risposte. Essa dipende dal package exception per tradurre i ResultEnum in istanze di ResponseMessage. Dall’altra parte, l’handler globale delle eccezioni (ExceptionHandle) nel package com.stalary.pf.message.exception importa ResponseMessage per costruire la risposta HTTP in caso di errore. Ne derivava un ciclo di dipendenza:

text
Copia
Modifica
data.vo.ResponseMessage ↔ exception.ExceptionHandle (e ResultEnum)
Obiettivo del refactoring
Rimuovere ogni dipendenza ciclica tra il layer di presentazione delle risposte (vo) e quello di gestione delle eccezioni, isolando i tipi condivisi in un package neutro e rompendo i riferimenti circolari.

Strategia adottata
Introduzione di un modulo “common”

È stato creato un nuovo package com.stalary.pf.message.common, destinato a ospitare tutti gli oggetti e le enumerazioni condivise trasversalmente (ResponseMessage, ResultEnum e possibili altri tipi utili).

Questo package viene confezionato come una libreria JAR, non come un microservizio: non espone né processi né endpoint, ma solo classi importabili.

Spostamento delle classi condivise

ResponseMessage e ResultEnum sono stati rimossi dai loro package originali (vo ed exception) e collocati in common.

Di conseguenza:

Il package vo non importa più nulla da exception.

Il package exception non importa più classi da vo, ma solo da common.

Aggiornamento dei consumer

In ogni microservizio o modulo che utilizzava ResponseMessage o ResultEnum, è stata aggiunta una dipendenza Maven/Gradle verso il common module.

I package originali (vo, exception) ora dipendono unicamente da common, eliminando il ciclo.

Verifica

Dopo il refactoring, l’analisi con Arcan non segnala più alcuna Cyclic Dependency tra i layer coinvolti.

La struttura delle dipendenze risulta ora chiara e unidirezionale:

nginx
Copia
Modifica
vo → common ← exception
Il modulo common non è un microservizio autonomo, ma semplicemente un contenitore di classi condivise.

Vantaggi ottenuti
Architettura pulita: ogni layer (VO, exception handler, service, ecc.) vede solo il package common per i tipi condivisi, senza cicli.

Riuso centralizzato: tutte le risorse comuni sono in un unico artefatto, riducendo duplicazioni e drift.

Manutenibilità e testabilità: modifiche a ResponseMessage o a nuovi codici di errore non richiedono interventi incrociati nei singoli servizi, ma solo un aggiornamento della libreria common.

In tal modo abbiamo efficacemente eliminato la Cyclic Dependency e ottenuto un design più modulare, coerente e facilmente estendibile.