Riassunto rapido per spezzare la dipendenza ciclica tra RpushClient, RpushClientHandler e RouteApi:

Estrai l’interfaccia ClientContext

Definisci in un package “neutro” da cui nessuno dipende già (es. com.regent.rpush.client.spi oppure direttamente in com.regent.rpush.client).

Firma:

java
Copia
Modifica
public interface ClientContext {
  void reconnect();
  List<MsgProcessor> getMsgProcessors();
}
Implementa l’interfaccia in RpushClient

Aggiungi public a reconnect() e getMsgProcessors().

RpushClient implements ClientContext.

Modifica RpushClientHandler

Costruttore e campi accettano ora un ClientContext anziché un RpushClient concreto.

Handler chiama ctx.reconnect() e ctx.getMsgProcessors().

Risultato sul grafo di dipendenze

client.spi (o client) non dipende da nulla.

RpushClient dipende da client.spi (interfaccia) e da client.api (per RouteApi).

client.api (RouteApi) non dipende da client né da spi.

➤ Nessun ciclo: il flusso diventa unidirezionale e rispetta il principio di Dependency Inversion.