 Rifattorizzazione di uno Hub-Like Dependency Smell in PromotionProduct
üîç Contesto iniziale
Nel modulo mall-domain, la classe PromotionProduct rappresentava un aggregato ricco di dipendenze dirette, ereditando da PmsProduct e contenendo tre liste relative a:

stock (PmsSkuStock)

sconti a scaglione (PmsProductLadder)

riduzioni sul prezzo (PmsProductFullReduction)

java
Copia
Modifica
public class PromotionProduct extends PmsProduct {
    private List<PmsSkuStock> skuStockList;
    private List<PmsProductLadder> productLadderList;
    private List<PmsProductFullReduction> productFullReductionList;
}
Questa struttura ha fatto emergere, tramite Arcan, un Hub-Like Dependency smell, caratterizzato da:

elevato fan-out (dipendenza diretta da molte classi),

bassa coesione interna (responsabilit√† miste),

difficolt√† di riuso e test.

üîß Strategia di refactoring
Per rimuovere il problema, si √® adottata una strategia in due fasi:

Sostituzione dell‚Äôereditariet√† con composizione:

PromotionProduct non estende pi√π PmsProduct, ma lo incapsula come campo.

Introduzione di una struttura modulare per le promozioni:

Le responsabilit√† relative a sconti e stock sono state spostate nella nuova classe PromotionRules, suddivisa in tre sotto-componenti:

StockPolicy

DiscountPolicy

ReductionPolicy

java
Copia
Modifica
public class PromotionProduct {
    private PmsProduct product;
    private PromotionRules promotionRules;
}
‚úÖ Risultato: rimozione dello Hub-Like Dependency
Questa rifattorizzazione ha comportato:

una riduzione del Technical Debt (TD) secondo Arcan,

una minore instabilit√† architetturale nella classe PromotionProduct,

una migliore separazione delle responsabilit√†, pi√π aderente ai principi SOLID (in particolare Single Responsibility e Open/Closed).

‚ö†Ô∏è Effetto collaterale: comparsa di uno Unstable Dependency smell nel modulo portal
Dopo il refactoring, il modulo com.mtcarpenter.mall.portal ha iniziato a dipendere dal pacchetto com.mtcarpenter.mall.domain.promotion, che √® ora pi√π instabile perch√© contiene classi che possono evolvere (le policy di promozione).

Questo ha introdotto un debole Unstable Dependency smell, ma √® architetturalmente accettabile, poich√©:

il modulo portal agisce come modulo UI/di presentazione, e quindi √® normale che dipenda da modelli di dominio stabili e/o instabili;

le nuove classi introdotte sono ben separate e modulabili;

l'accoppiamento √® controllato e localizzato all'interno di poche entry point (es. getPromotionProductList nel controller).

üéØ Conclusione
Il refactoring ha permesso di:

eliminare un code smell architetturalmente critico (Hub),

ridurre il peso architetturale di una classe centrale,

migliorare la manutenibilit√† e testabilit√† del codice,

accettare un compromesso consapevole (Unstable Dependency localizzato) a favore della modularit√† e coesione.

üìâ Technical Debt complessivo: Ridotto


 Eliminazione dello Hub-like Dependency nella classe PromotionProduct
Durante l‚Äôanalisi architetturale del progetto con Arcan, √® stato rilevato uno smell di tipo Hub-like Dependency nella classe PromotionProduct. Questo smell si manifesta tipicamente in presenza di classi che fungono da nodo centrale nel grafo delle dipendenze, con elevato fan-out e una bassa coesione interna. In particolare, PromotionProduct estendeva la classe PmsProduct e incorporava direttamente tre liste eterogenee relative a informazioni di stock, sconti a scaglione e riduzioni sul prezzo, violando cos√¨ il principio di Responsabilit√† Singola (SRP) di SOLID.

Per rimuovere lo smell, √® stata effettuata una rifattorizzazione strutturale basata sui suggerimenti del tool Arcan e delle tecniche documentate nella sua guida ufficiale. La strategia seguita ha previsto:

la sostituzione dell‚Äôereditariet√† con composizione, incapsulando PmsProduct come attributo della nuova PromotionProduct;

l‚Äôintroduzione di una struttura modulare PromotionRules, che a sua volta √® stata suddivisa in tre componenti: StockPolicy, DiscountPolicy e ReductionPolicy.

Questo approccio ha permesso di migliorare la modularit√† della classe, ridurre il peso architetturale associato, e semplificare la futura evoluzione del codice, in linea con il principio di Open/Closed (OCP).

Di seguito la nuova struttura:

java
Copia
Modifica
public class PromotionProduct {
    private PmsProduct product;
    private PromotionRules promotionRules;
}
La rifattorizzazione ha portato a una riduzione significativa del Technical Debt (TD) associato al modulo domain, secondo le metriche fornite da Arcan. Tuttavia, come effetto collaterale, √® comparso un lieve Unstable Dependency smell nel modulo mall.portal, ora dipendente dal nuovo package domain.promotion.

Tale dipendenza instabile √® risultata accettabile per due motivi:

il modulo portal svolge un ruolo di presentazione e orchestrazione, che giustifica la dipendenza da classi di dominio;

le nuove classi promozionali sono coese, incapsulate e facilmente sostituibili, riducendo il rischio di propagazione delle modifiche.

In sintesi, la rifattorizzazione ha raggiunto l‚Äôobiettivo principale: eliminare uno smell strutturalmente critico, migliorando la qualit√† architetturale del sistema e accettando un compromesso localizzato e giustificato. Questo intervento ha rappresentato un trade-off consapevole tra stabilit√† e modularit√†, principio chiave nella gestione tecnica del debito architetturale.