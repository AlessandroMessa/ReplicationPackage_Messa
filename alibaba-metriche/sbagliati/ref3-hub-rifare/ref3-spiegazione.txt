Rifattorizzazione dello Smell Hub-Like Dependency nella classe PromotionProduct
Durante l‚Äôanalisi statica del progetto mall-cloud-alibaba, lo strumento Arcan ha rilevato la presenza di uno smell architetturale di tipo Hub-Like Dependency nella classe PromotionProduct, con hub size pari a 11 e 23 usi diretti. Questo smell si manifesta quando una classe centralizza troppe responsabilit√† e viene utilizzata da molte altre, generando un forte accoppiamento e una violazione del principio di Single Responsibility.

üîç Problema iniziale
La classe PromotionProduct estendeva direttamente la classe PmsProduct e conteneva ulteriori liste collegate alle informazioni promozionali del prodotto:

List<PmsSkuStock> skuStockList

List<PmsProductLadder> productLadderList

List<PmsProductFullReduction> productFullReductionList

Questo design causava:

Eccessivo accoppiamento con PmsProduct tramite ereditariet√†

Coesistenza di responsabilit√† eterogenee in un‚Äôunica classe

Difficolt√† di manutenzione e testabilit√†

üõ†Ô∏è Strategia di rifattorizzazione
In linea con le best practice Arcan per rimuovere gli Hub-Like Dependencies, √® stata adottata la seguente strategia:

Sostituzione dell‚Äôereditariet√† con composizione
La classe PromotionProduct non estende pi√π PmsProduct, ma ne mantiene un riferimento interno:

java
Copia
Modifica
private PmsProduct product;
Separazione delle responsabilit√† in classi coese:
Sono state introdotte due classi ausiliarie:

SkuStockInfo per la gestione dell‚Äôinventario SKU

DiscountInfo per la gestione di sconti e promozioni

java
Copia
Modifica
private SkuStockInfo skuStockInfo;
private DiscountInfo discountInfo;
Aggiunta di metodi di delega nei casi pi√π frequenti:
Per evitare una verbosit√† eccessiva (promotionProduct.getProduct().getPromotionType()), sono stati aggiunti metodi di delega diretta per i campi pi√π frequentemente utilizzati.

Aggiornamento del ResultMap di MyBatis:
√à stato rifattorizzato anche il resultMap XML associato a PromotionProduct, eliminando l‚Äôestensione da PmsProductMapper.BaseResultMap e definendo manualmente l‚Äôassociazione annidata via <association property="product" ...>.

√à stato inoltre deciso di mappare solo i campi realmente utilizzati del PmsProduct, per ridurre il rumore e minimizzare la possibilit√† di code smell legati a campi non referenziati.

‚úÖ Benefici ottenuti
Aspetto	Prima	Dopo
Coesione	Bassa	Alta (classi coese)
Accoppiamento	Alto (ereditariet√† + dipendenze dirette)	Ridotto (composizione)
Riutilizzabilit√†	Limitata	Migliore separazione dei dati
Manutenibilit√†	Complessa	Struttura chiara e modulare
Testabilit√†	Difficile	Ogni componente pu√≤ essere testato singolarmente
Mapping MyBatis	Esteso tramite ereditariet√†	Esplicito e focalizzato solo sui campi necessari

üß© Considerazioni finali
La rifattorizzazione ha permesso di ridurre significativamente l‚Äôimpatto dello smell Hub-Like Dependency e ha portato a un design pi√π modulare, flessibile e allineato con i principi SOLID. √à stato adottato un approccio incrementale e conservativo, mantenendo la compatibilit√† con i servizi esistenti e minimizzando l‚Äôimpatto sul sistema complessivo.

risolto ma introdotto un unstable dependency