Eliminazione dello Smell "Hub-Like Dependency" nel modulo order.service.cart
Durante l’analisi architetturale del progetto, è stato identificato un Architectural Smell di tipo Hub-Like Dependency nel package com.mtcarpenter.mall.portal.order.service.cart. Il valore di severità rilevato dallo strumento Arcan era pari a 7, esattamente uguale alla soglia stabilita per la rilevazione del smell (Fan-In + Fan-Out > 7). Il package risultava avere un Fan-In pari a 3 e un Fan-Out pari a 4, indicando un elevato grado di accoppiamento sia in ingresso che in uscita.

Obiettivo del refactoring
L’obiettivo era eliminare o ridurre il Hub-Like Dependency, agendo direttamente su:

la riduzione del Fan-Out, ovvero il numero di dipendenze dirette in uscita

la segmentazione delle responsabilità per migliorare la coesione interna del package

Strategie applicate
1. Introduzione di provider dedicati
È stato creato un set di provider in mall-support, con responsabilità ben separate:

Provider	Responsabilità
CartItemDataProvider	Accesso diretto al database per gli item del carrello
ProductQueryProvider	Accesso remoto alle informazioni di prodotto
PromotionProvider	Calcolo delle promozioni tramite OmsPromotionService

Questi provider hanno permesso di delegare la logica tecnica e ridurre il numero di dipendenze dirette della classe OmsCartItemServiceImpl.

2. Separazione per responsabilità (SRP)
L’interfaccia OmsCartItemService, originariamente centralizzata, è stata scomposta logicamente in tre interfacce più coese:

Interfaccia	Metodo	Package
CartReadService	list, getCartProduct	order.service.cart.read
CartWriteService	add, updateAttr, updateQuantity, delete, clear	order.service.cart.write
CartPromotionService	listPromotion	inizialmente in cart.promotion

Successivamente, è stato deciso di integrare listPromotion direttamente in CartReadService, in quanto rappresenta un'operazione di lettura arricchita e non giustificava la creazione di un servizio separato.

3. Riorganizzazione dei package
Per evitare che il nuovo package provider diventasse un hub a sua volta, è stata definita una struttura modulare per contesto funzionale, ad esempio:

sql
Copia codice
com.mtcarpenter.provider
├── cart
│   ├── CartItemDataProvider
│   ├── ProductQueryProvider
│   └── PromotionProvider
├── coupon
├── stock
├── member
├── order
Questa suddivisione previene la concentrazione eccessiva di dipendenze nello stesso package.

Risultato
Il package originariamente responsabile dello smell (order.service.cart) è stato completamente rifattorizzato. Ogni nuova implementazione (CartReadServiceImpl, CartWriteServiceImpl) ha ora:

un fan-out ridotto

una singola responsabilità

dipendenze gestite tramite provider specializzati

Grazie a questo intervento, il valore aggregato Fan-In + Fan-Out dei singoli sottopacchetti è sceso al di sotto della soglia critica. Il package non viene più identificato da Arcan come Hub-Like.

Considerazioni
Questo intervento ha evidenziato come uno smell possa emergere anche in pacchetti con responsabilità corrette, ma mal distribuite. È stato risolto applicando:

principi di progettazione SOLID (SRP, DIP)

modularizzazione funzionale

rifattorizzazione architetturale assistita da tool statici